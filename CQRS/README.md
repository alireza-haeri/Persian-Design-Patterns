# ุงูฺฏู CQRS (ุชูฺฉฺฉ ูุฑูุงู ู ูพุฑุณโูุฌู)

## ๐ฏ ูุฏู
CQRS ูพุดููุงุฏ ูโฺฉูุฏ **ุฏุณุชูุฑุงุช (ููุดุชู)** ู **ูพุฑุณโูุฌููุง (ุฎูุงูุฏู)** ุฑุง ุงุฒ ูู ุฌุฏุง ฺฉูู ุชุง ูุฑ ฺฉุฏุงู ุจููู ู ูุณุชูู ุชูุณุนู ุงุจูุฏ. ุงู ุฌุฏุงุณุงุฒ ุจู ูุง ุงุฌุงุฒู ูโุฏูุฏ ูุฏู ุฎูุงูุฏู ุฑุง ุจุฑ ุงุณุงุณ ูุงุฒ ฺฏุฒุงุฑุดโฺฏุฑ ู ูุฏู ููุดุชู ุฑุง ุจุฑ ุงุณุงุณ ููุทู ุฏุงููู ุทุฑุงุญ ฺฉูู.

## ๐ป ูุซุงู ฺฉุฏ (C#)

```csharp
// ูุฑูุงูโูุง (Write Model)
public record CreateOrderCommand(Guid Id, string Customer);

public interface ICommandHandler<TCommand>
{
    Task Handle(TCommand command);
}

public class CreateOrderHandler : ICommandHandler<CreateOrderCommand>
{
    private readonly IOrderRepository _orders;
    private readonly IEventBus _bus; // ุจุฑุง ุงูุชุดุงุฑ ุฑูุฏุงุฏูุง

    public CreateOrderHandler(IOrderRepository orders, IEventBus bus)
    {
        _orders = orders;
        _bus = bus;
    }

    public async Task Handle(CreateOrderCommand command)
    {
        var order = new Order(command.Id, command.Customer);
        await _orders.Save(order);
        await _bus.Publish(new OrderCreatedEvent(order.Id, order.Customer)); // ุจู Outbox ุง ูพุงูโุฑุณุงู
    }
}

// ูพุฑุณโูุฌููุง (Read Model)
public record GetOrderDto(Guid Id, string Customer, string Status);
public record GetOrderQuery(Guid Id);

public interface IQueryHandler<TQuery, TResult>
{
    Task<TResult> Handle(TQuery query);
}

public class GetOrderHandler : IQueryHandler<GetOrderQuery, GetOrderDto?>
{
    private readonly IReadOnlyOrderView _view; // ุฌุฏูู ููุง ุฎูุงูุฏู

    public GetOrderHandler(IReadOnlyOrderView view) => _view = view;

    public Task<GetOrderDto?> Handle(GetOrderQuery query)
        => _view.Find(query.Id); // ูุณุชููุงู ุงุฒ ูพุงฺฏุงู ุฏุงุฏู ุฎูุงูุฏู
}
```

## ๐ ฺู ุฒูุงู ุงุณุชูุงุฏู ฺฉููุ
1. ุณุณุชูโูุง ุจุง **ุฎูุงูุฏู ุจุณุงุฑ ุจุดุชุฑ ุงุฒ ููุดุชู** ุง ูุงุฒูุง ูุชูุงูุช ุนููฺฉุฑุฏ ุจุฑุง ูุฑฺฉุฏุงู
2. ุฒูุงู ฺฉู **ูุฏู ุฏุงููู ูพฺุฏู** ุงุณุช ู ูโุฎูุงูุฏ ุณุงุฏูโุณุงุฒ ููุง ุฎูุงูุฏู ุฑุง ุฌุฏุงฺฏุงูู ุงูุฌุงู ุฏูุฏ
3. ุฒูุงู ฺฉู ุจู **Event Sourcing / Outbox / ูพุงูโุฑุณุงู** ูุงุฒ ุฏุงุฑุฏ ู ูโุฎูุงูุฏ ุฌุฑุงู ููุดุชู ุงุฒููู ุจุงุดุฏ
4. ุจุฑุง **ููุงุณโูพุฐุฑ ูุณุชูู** ูุงูโูุง ุฎูุงูุฏู ู ููุดุชู (ุจุงูฺฉ ุงุทูุงุนุงุช/ฺฉุด ูุชูุงูุช)

## โ ูุฒุงุง
- **ุจูููโุณุงุฒ ูุณุชูู** ุฎูุงูุฏู ู ููุดุชู
- **ฺฉุงูุด ฺฉููพููฺฏ** ุจู ููุทู ุฏุงููู ู ูุงุฒูุง ฺฏุฒุงุฑุดโฺฏุฑ
- **ููุงุณโูพุฐุฑ ูุฌุฒุง** ู ุงูฺฉุงู ุงุณุชูุงุฏู ุงุฒ ุฐุฎุฑูโุณุงุฒ ูุชูุงูุช
- ุณุงุฒฺฏุงุฑ ุฎูุจ ุจุง **Event Driven** ู **Outbox**

## โ ูุนุงุจ
- **ูพฺุฏฺฏ ุจุดุชุฑ** ุฏุฑ ูุนูุงุฑ ู ุงุณุชูุฑุงุฑ
- ูุงุฒ ุจู **ููฺฏุงูโุณุงุฒ ุฏุงุฏูโูุง** ุจู ูุฏู ููุดุชู ู ูุฏู ุฎูุงูุฏู (lag)
- ููุงุณุจ ูุจูุฏู ุจุฑุง **ุงูพูฺฉุดูโูุง ุณุงุฏู** ุจุง ุฏุงููู ฺฉูฺฺฉ

## ๐ ูฺฉุงุช ฺฉูุฏ
- ุฏุณุชูุฑูุง ุจุงุฏ **Side Effect** ุฏุงุดุชู ุจุงุดูุฏ ุงูุง ุฎุฑูุฌ ูุฏููุฏุ ูพุฑุณโูุฌููุง **ููุท ุฎูุงูุฏู** ุจุงุดูุฏ.
- ูุฏู ุฎูุงูุฏู ุฑุง ูโุชูุงู ุฑู **Viewูุง ุจููู** ุง ฺฉุด ูฺฏู ุฏุงุดุช.
- ูุนูููุงู ููุฑุงู ุจุง **Event Sourcing** ุง **Outbox** ุงุณุชูุงุฏู ูโุดูุฏ ุชุง ูพุงุฏุงุฑ ู ููฺฏุงูโุณุงุฒ ุชุถูู ุดูุฏ.
- ุญุฏุงููโฺฏุฑุง: ููุท ุฒูุงู ุจู ุณุฑุงุบ CQRS ุจุฑูุฏ ฺฉู **ุฏุฑุฏ ูุนู** (ฺฏุฒุงุฑุดโูุง ุณูฺฏูุ ููุงุณโูพุฐุฑ) ุขู ุฑุง ุชูุฌู ฺฉูุฏ.
