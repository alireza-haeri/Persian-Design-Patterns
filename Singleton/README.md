# ๐ ุงูฺฏู ุชฺฉโููููู (Singleton)

## ๐ฏ ูุฏู

ุงูฺฏู **Singleton** ฺฉ ุงูฺฏู ุทุฑุงุญ ุณุงุฒูุฏู (Creational) ุงุณุช ฺฉู **ุชุถูู ูโฺฉูุฏ ฺฉ ฺฉูุงุณ ุชููุง ฺฉ ููููู (instance) ุฏุงุดุชู ุจุงุดุฏ** ู ฺฉ ููุทู ุฏุณุชุฑุณ ุณุฑุงุณุฑ (global access point) ุจู ุขู ููููู ูุฑุงูู ูโฺฉูุฏ.

ุจู ุนุจุงุฑุช ุฏฺฏุฑุ ุงู ุงูฺฏู ุงุทููุงู ูโุฏูุฏ ฺฉู ุงุฒ ฺฉ ฺฉูุงุณ ููุท ฺฉ ุดุก ุฏุฑ ฺฉู ุจุฑูุงูู ุงุฌุงุฏ ุดูุฏ ู ููู ุจุฎุดโูุง ุจุฑูุงูู ุงุฒ ููุงู ฺฉ ููููู ุงุณุชูุงุฏู ฺฉููุฏ.

## ๐ค ูุดฺฉู

ุฏุฑ ุจุฑูุงููโููุณุ ฺฏุงู ุงููุงุช ูุงุฒ ุฏุงุฑู ฺฉู ุงุฒ ฺฉ ฺฉูุงุณ ุฎุงุต **ููุท ฺฉ ููููู** ุฏุฑ ฺฉู ุจุฑูุงูู ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ. ุจู ุนููุงู ูุซุงู:

- **ูุฏุฑ ูพฺฉุฑุจูุฏ (Configuration Manager)**: ุชูุธูุงุช ุจุฑูุงูู ุจุงุฏ ุฏุฑ ฺฉ ุฌุง ุฐุฎุฑู ู ูุฏุฑุช ุดููุฏ
- **Logger (ุซุจุชโฺฉููุฏู ุฑูุฏุงุฏูุง)**: ุชูุงู logโูุง ุจุงุฏ ุฏุฑ ฺฉ ูุงู ุง ุณุณุชู ูุงุญุฏ ุซุจุช ุดููุฏ
- **Connection Pool**: ูุฏุฑุช ูุชูุฑฺฉุฒ ุงุชุตุงูุงุช ุจู ูพุงฺฏุงู ุฏุงุฏู
- **Driver Manager**: ูุฏุฑุช ุฏุฑุงูุฑูุง ุณุฎุชโุงูุฒุงุฑ
- **Cache Manager**: ูุฏุฑุช ฺฉุด ุฏุงุฏูโูุง ุฏุฑ ุญุงูุธู

ุงฺฏุฑ ุจุฏูู Singleton ุนูู ฺฉููุ ููฺฉู ุงุณุช ฺูุฏู ููููู ุงุฒ ุงู ฺฉูุงุณโูุง ุงุฌุงุฏ ุดูุฏ ฺฉู ููุฌุฑ ุจู:
- **ูุตุฑู ุจุดุชุฑ ููุงุจุน** (ุญุงูุธูุ ูุงูโูุงุ ุงุชุตุงูุงุช)
- **ุนุฏู ููุงููฺฏ ุฏุงุฏูโูุง** (ูุฑ ููููู ุฏุงุฏูโูุง ูุชูุงูุช ุฏุงุฑุฏ)
- **ูพฺุฏฺฏ ุฏุฑ ูุฏุฑุช** (ููโุฏุงูู ฺฉุฏุงู ููููู ุฑุง ุงุณุชูุงุฏู ฺฉูู)

**ูุซุงู ูุงูุน**: ูุฑุถ ฺฉูุฏ ุฏุฑ ุจุฑูุงูู ุดูุง ฺฉ ฺฉูุงุณ `DatabaseConnection` ุฏุงุฑุฏ. ุงฺฏุฑ ูุฑ ุจุงุฑ ฺฉู ูุงุฒ ุจู ุฏุณุชุฑุณ ุจู ุฏุชุงุจุณ ุฏุงุฑุฏ ฺฉ ููููู ุฌุฏุฏ ุจุณุงุฒุฏุ ููฺฉู ุงุณุช ุตุฏูุง ุงุชุตุงู ุจุงุฒ ุจู ุฏุชุงุจุณ ุฏุงุดุชู ุจุงุดุฏ ฺฉู ููุงุจุน ุณุฑูุฑ ุฑุง ุจู ุงุชูุงู ูโุฑุณุงูุฏ!

## ๐ก ุฑุงูโุญู

ุงูฺฏู Singleton ุงู ูุดฺฉู ุฑุง ุจุง ุฏู ูุฏู ุญู ูโฺฉูุฏ:

1. **ุณุงุฒูุฏู (Constructor) ุฑุง private ฺฉูุฏ**: ุชุง ฺฉุณ ูุชูุงูุฏ ุจุง `new` ูุณุชููุงู ุดุก ุจุณุงุฒุฏ
2. **ฺฉ ูุชุฏ static ุนููู ุงุฌุงุฏ ฺฉูุฏ**: ฺฉู ุจู ุนููุงู ุณุงุฒูุฏู ุนูู ูโฺฉูุฏ ู ููููู ูุงุญุฏ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ

ุงู ูุชุฏ ุฏุฑ ุงููู ูุฑุงุฎูุงูุ ุดุก ุฑุง ูโุณุงุฒุฏ ู ุฏุฑ ูุฑุงุฎูุงูโูุง ุจุนุฏ ููุงู ุดุก ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.

## ๐ ุณุงุฎุชุงุฑ

```mermaid
classDiagram
    class Singleton {
        -static Singleton instance ๐
        -Singleton() ๐
        +static GetInstance() Singleton โจ
        +BusinessLogic() ๐
    }
    
    class Client1 {
        +UseService() ๐ค
    }
    
    class Client2 {
        +UseService() ๐ฅ
    }
    
    Client1 --> Singleton : ููุดู ููุงู ููููู ุฑุง ุฏุฑุงูุช ูโฺฉูุฏ
    Client2 --> Singleton : ููุดู ููุงู ููููู ุฑุง ุฏุฑุงูุช ูโฺฉูุฏ
    
    note for Singleton "ุชููุง ฺฉ ููููู ุฏุฑ ฺฉู ุจุฑูุงูู โ"
```

## ๐ป ูพุงุฏูโุณุงุฒ ุจุง C#

### ุฑูุด ุงูู: Thread-Safe ุจุง Double-Check Locking

```csharp
public sealed class ConfigurationManager
{
    private static ConfigurationManager _instance;
    private static readonly object _lock = new object();

    public Dictionary<string, string> Settings { get; }

    // ุณุงุฒูุฏู private - ฺฉุณ ููโุชูุงูุฏ ูุณุชููุงู ุดุก ุจุณุงุฒุฏ
    private ConfigurationManager()
    {
        Settings = new Dictionary<string, string>
        {
            { "AppName", "MyApp" },
            { "Version", "1.0" },
            { "Database", "SQL Server" }
        };
    }

    // ูุชุฏ ุงุณุชุงุชฺฉ ุจุฑุง ุฏุฑุงูุช ููููู ูุงุญุฏ
    public static ConfigurationManager Instance
    {
        get
        {
            // ุจุฑุฑุณ ุงูู: ุจุฏูู lock ุจุฑุง ุจูุจูุฏ ฺฉุงุฑุง
            if (_instance == null)
            {
                lock (_lock) // ููู ุจุฑุง thread-safety
                {
                    // ุจุฑุฑุณ ุฏูู: ุฏุฑูู lock
                    if (_instance == null)
                    {
                        _instance = new ConfigurationManager();
                    }
                }
            }
            return _instance;
        }
    }

    public string GetSetting(string key) => 
        Settings.TryGetValue(key, out var value) ? value : "Not Found";
}

// ุงุณุชูุงุฏู
class Program
{
    static void Main()
    {
        // ูุฑ ุฏู ูุชุบุฑ ุจู ููุงู ููููู ุงุดุงุฑู ูโฺฉููุฏ
        var config1 = ConfigurationManager.Instance;
        var config2 = ConfigurationManager.Instance;

        Console.WriteLine($"ุขุง ฺฉุณุงู ูุณุชูุฏุ {config1 == config2}"); // True
        Console.WriteLine($"ูุงู ุจุฑูุงูู: {config1.GetSetting("AppName")}"); // MyApp
        Console.WriteLine($"ูพุงฺฏุงู ุฏุงุฏู: {config2.GetSetting("Database")}"); // SQL Server
    }
}
```

### ุฑูุด ุฏูู: Lazy Initialization (ุณุงุฏูโุชุฑ ู ุงููโุชุฑ)

```csharp
public sealed class Logger
{
    // Lazy<T> ุฎูุฏ thread-safe ุงุณุช
    private static readonly Lazy<Logger> _instance = 
        new Lazy<Logger>(() => new Logger());

    private Logger()
    {
        Console.WriteLine("โ Logger ุงุฌุงุฏ ุดุฏ");
    }

    public static Logger Instance => _instance.Value;

    public void Log(string message) => 
        Console.WriteLine($"๐ [{DateTime.Now:HH:mm:ss}] {message}");
}

// ุงุณุชูุงุฏู
Logger.Instance.Log("ุจุฑูุงูู ุดุฑูุน ุดุฏ");
Logger.Instance.Log("ุนููุงุช ุงูุฌุงู ุดุฏ");
```

## ๐ฏ ูุซุงู ูุงูุน: ุณุณุชู Cache

```csharp
public sealed class CacheManager
{
    private static readonly Lazy<CacheManager> _instance = 
        new Lazy<CacheManager>(() => new CacheManager());
    
    private readonly Dictionary<string, object> _cache = new();

    private CacheManager() { }

    public static CacheManager Instance => _instance.Value;

    public void Set(string key, object value) => _cache[key] = value;
    
    public T Get<T>(string key) => 
        _cache.TryGetValue(key, out var value) ? (T)value : default;

    public bool Exists(string key) => _cache.ContainsKey(key);
}

// ุงุณุชูุงุฏู
CacheManager.Instance.Set("user:1", new { Name = "ุนู", Age = 25 });
var user = CacheManager.Instance.Get<dynamic>("user:1");
Console.WriteLine($"ูุงู: {user.Name}"); // ุนู
```

## โ๏ธ ูุฒุงุง ู ูุนุงุจ

### ูุฒุงุง โ

1. **ฺฉูุชุฑู ุฏุณุชุฑุณ ุจู ููููู ูุงุญุฏ**: ุชุถูู ูโฺฉูุฏ ููุท ฺฉ ููููู ูุฌูุฏ ุฏุงุฑุฏ
2. **ุฏุณุชุฑุณ ุณุฑุงุณุฑ**: ุงุฒ ูุฑ ููุทู ุงุฒ ุจุฑูุงูู ูุงุจู ุฏุณุชุฑุณ ุงุณุช
3. **ููุฏุงุฑุฏู ุชูุจู (Lazy Initialization)**: ููููู ููุท ุฒูุงู ุณุงุฎุชู ูโุดูุฏ ฺฉู ูุงุฒ ุจุงุดุฏ
4. **ุตุฑููโุฌู ุฏุฑ ููุงุจุน**: ุงุฒ ุงุฌุงุฏ ูููููโูุง ุงุถุงู ุฌููฺฏุฑ ูโฺฉูุฏ
5. **ูุฏุฑุช ูุชูุฑฺฉุฒ**: ุชูุงู ุนููุงุช ุงุฒ ฺฉ ููุทู ูุฏุฑุช ูโุดููุฏ
6. **Thread-Safe**: ุจุง ูพุงุฏูโุณุงุฒ ุตุญุญุ ุฏุฑ ูุญุทโูุง ฺูุฏูุฎ ุงูู ุงุณุช

### ูุนุงุจ โ

1. **ููุถ ุงุตู ุชฺฉ ูุณุฆููุช**: ฺฉูุงุณ ูู ูุณุฆูู ููุทู ฺฉุณุจโูฺฉุงุฑ ู ูู ูุฏุฑุช ููููู ุฎูุฏ ุงุณุช
2. **ุณุฎุช ุฏุฑ ุชุณุช**: Mock ฺฉุฑุฏู Singleton ุฏุฑ Unit Test ุฏุดูุงุฑ ุงุณุช
3. **ูุงุจุณุชฺฏ ุณุฎุช (Tight Coupling)**: ฺฉูุงุณโูุง ุฏฺฏุฑ ุจู Singleton ูุงุจุณุชู ูโุดููุฏ
4. **ูุดฺฉูุงุช ฺูุฏูุฎ**: ุงฺฏุฑ ุฏุฑุณุช ูพุงุฏูโุณุงุฒ ูุดูุฏุ ูโุชูุงูุฏ ูุดฺฉู ุงุฌุงุฏ ฺฉูุฏ
5. **ูพููุงู ฺฉุฑุฏู ูุงุจุณุชฺฏโูุง**: ุงุณุชูุงุฏู ูุณุชูู ุงุฒ Instance ุจุงุนุซ ูโุดูุฏ ูุงุจุณุชฺฏโูุง ูุดุฎุต ูุจุงุดูุฏ
6. **ูุดฺฉู ุฏุฑ ูุญุทโูุง ุชูุฒุนโุดุฏู**: ุฏุฑ ุณุณุชูโูุง ฺูุฏ ุณุฑูุฑุ ูุฑ ุณุฑูุฑ ฺฉ ููููู ุฌุฏุงฺฏุงูู ุฏุงุฑุฏ

## ๐ ฺู ุฒูุงู ุงุณุชูุงุฏู ฺฉููุ

### โ ุงุณุชูุงุฏู ฺฉูุฏ ููุช:

1. **ุฏููุงู ฺฉ ููููู ูุงุฒ ุฏุงุฑุฏ**: ูุซู ูุฏุฑ ูพฺฉุฑุจูุฏุ ูุฏุฑ ุงุชุตุงูุ Logger
2. **ุฏุณุชุฑุณ ุณุฑุงุณุฑ ูุงุฒู ุงุณุช**: ููู ุจุฎุดโูุง ุจุฑูุงูู ุจุงุฏ ุจู ฺฉ ููููู ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏ
3. **ฺฉูุชุฑู ุฏูู ุฑู ููุงุจุน**: ูุฏุฑุช ููุงุจุน ูุญุฏูุฏ ูุซู Connection Pool
4. **ููุงููฺฏ ูุชูุฑฺฉุฒ**: ุนููุงุช ฺฉู ุจุงุฏ ุงุฒ ฺฉ ููุทู ููุงููฺฏ ุดููุฏ

### โ ุงุณุชูุงุฏู ูฺฉูุฏ ููุช:

1. **ูุงุฒ ุจู ฺูุฏู ููููู ุฏุงุฑุฏ**: ุงฺฏุฑ ููฺฉู ุงุณุช ุฏุฑ ุขูุฏู ุจุดุชุฑ ุงุฒ ฺฉ ููููู ูุงุฒ ุจุงุดุฏ
2. **ุชุณุชโูพุฐุฑ ููู ุงุณุช**: Singleton ุชุณุช ูุงุญุฏ ุฑุง ุณุฎุช ูโฺฉูุฏ
3. **ูโุชูุงู ุงุฒ Dependency Injection ุงุณุชูุงุฏู ฺฉุฑุฏ**: DI ุฑุงูโุญู ุจูุชุฑ ุงุณุช
4. **State ูุงุจู ุชุบุฑ ุฏุงุฑุฏ**: ุงฺฏุฑ ูุถุนุช ุชุบุฑ ูโฺฉูุฏุ ูุดฺฉูุงุช concurrency ุงุฌุงุฏ ูโุดูุฏ

## ๐ฏ ฺฉุงุฑุจุฑุฏูุง ูุงูุน

1. **ูุฏุฑุช ูุงฺฏ (Logging)**: ฺฉ Logger ุจุฑุง ฺฉู ุจุฑูุงูู
2. **ูุฏุฑุช ูพฺฉุฑุจูุฏ (Configuration)**: ุชูุธูุงุช ุจุฑูุงูู
3. **Cache Manager**: ูุฏุฑุช ฺฉุด ุฏุฑ ุญุงูุธู
4. **Connection Pool**: ูุฏุฑุช ุงุชุตุงูุงุช ุจู ูพุงฺฏุงู ุฏุงุฏู
5. **Thread Pool**: ูุฏุฑุช threadโูุง
6. **Print Spooler**: ุตู ฺุงูพ ุฏุฑ ุณุณุชูโุนุงูู
7. **Device Drivers**: ูุฏุฑุช ุณุฎุชโุงูุฒุงุฑ

## ๐ก ูฺฉุงุช ููู ูพุงุฏูโุณุงุฒ

1. **sealed class**: ุงุฒ ฺฉููู ฺฉูุฏ `sealed` ุงุณุชูุงุฏู ฺฉูุฏ ุชุง ุงุฒ ูุฑุงุซุช ุฌููฺฏุฑ ุดูุฏ
2. **private constructor**: ุณุงุฒูุฏู ุจุงุฏ private ุจุงุดุฏ
3. **Thread-Safety**: ุฏุฑ ูุญุทโูุง ฺูุฏูุฎ ุงุฒ `lock` ุง `Lazy<T>` ุงุณุชูุงุฏู ฺฉูุฏ
4. **Lazy Initialization**: ุชุฑุฌุญุงู ุงุฒ `Lazy<T>` ุฏุฑ C# ุงุณุชูุงุฏู ฺฉูุฏ (ุณุงุฏูโุชุฑ ู ุงููโุชุฑ)
5. **Eager vs Lazy**: 
   - **Eager**: ููููู ุฏุฑ ุฒูุงู ุจุงุฑฺฏุฐุงุฑ ฺฉูุงุณ ุณุงุฎุชู ูโุดูุฏ
   - **Lazy**: ููููู ุฏุฑ ุงููู ุงุณุชูุงุฏู ุณุงุฎุชู ูโุดูุฏ

## ๐ ููุงุณู ุจุง ุงูฺฏููุง ูุดุงุจู

| ูฺฺฏ | Singleton | Static Class | Dependency Injection |
|-------|-----------|--------------|---------------------|
| ูููููโุณุงุฒ | ฺฉ ููููู | ุจุฏูู ููููู | ฺูุฏู ููููู ููฺฉู |
| ูุฑุงุซุช | ูโุชูุงูุฏ interface ูพุงุฏู ฺฉูุฏ | ุฎุฑ | ุจูู |
| ุชุณุชโูพุฐุฑ | ุณุฎุช | ุฎู ุณุฎุช | ุขุณุงู |
| Lazy Loading | ุจูู | ุฎุฑ | ุจูู |
| State | ุฏุงุฑุฏ | ูุฏุงุฑุฏ | ุฏุงุฑุฏ |

## ๐ ูฺฉุชู ฺฉูุฏ

> **ูุดุฏุงุฑ**: ุงุฒ Singleton ุฒุงุฏ ุงุณุชูุงุฏู ูฺฉูุฏ! ุงู ุงูฺฏู ฺฉ **Anti-Pattern** ูุญุณูุจ ูโุดูุฏ ุงฺฏุฑ ุจุด ุงุฒ ุญุฏ ุงุณุชูุงุฏู ุดูุฏ. ุฏุฑ ุจุฑูุงููโูุง ูุฏุฑูุ **Dependency Injection** ูุนูููุงู ฺฏุฒูู ุจูุชุฑ ุงุณุช.
>
> ุฏุฑ ASP.NET Core ุจู ุฌุง Singleton ุฏุณุชุ ุงุฒ `services.AddSingleton<T>()` ุงุณุชูุงุฏู ฺฉูุฏ.

---

**[๐ ุจุงุฒฺฏุดุช ุจู ุตูุญู ุงุตู](../index.html)**
